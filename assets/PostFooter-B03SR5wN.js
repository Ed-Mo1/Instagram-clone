import{r as l,c as E,af as T,ag as M,f as V,e as H,o as G,ah as q,a as O,j as s,i as P,l as R,k as I,p as $,q as z,ai as U,A,aj as J,J as f,$ as D,L as Y,U as g,M as K,E as Q,F as X,G as Z,H as ee,I as se,O as B,N as F,ak as te,al as ne,am as oe,an as ae,R as re,W as b,ao as ie,ap as ce,aq as le,ar as de,as as me}from"./index-BAF7UZVp.js";function ue(){const e=l.useRef(!0);return l.useEffect(()=>{e.current=!1},[]),e.current}function fe(e){const t=l.useRef();return l.useEffect(()=>{t.current=e},[e]),t.current}var he=E("div",{baseStyle:{boxShadow:"none",backgroundClip:"padding-box",cursor:"default",color:"transparent",pointerEvents:"none",userSelect:"none","&::before, &::after, *":{visibility:"hidden"}}}),v=T("skeleton-start-color"),L=T("skeleton-end-color"),ge=M({from:{opacity:0},to:{opacity:1}}),xe=M({from:{borderColor:v.reference,background:v.reference},to:{borderColor:L.reference,background:L.reference}}),p=V((e,t)=>{const o={...e,fadeDuration:typeof e.fadeDuration=="number"?e.fadeDuration:.4,speed:typeof e.speed=="number"?e.speed:.8},c=H("Skeleton",o),n=ue(),{startColor:r="",endColor:a="",isLoaded:i,fadeDuration:d,speed:u,className:x,fitContent:h,...m}=G(o),[y,S]=q("colors",[r,a]),w=fe(i),j=O("chakra-skeleton",x),k={...y&&{[v.variable]:y},...S&&{[L.variable]:S}};if(i){const C=n||w?"none":`${ge} ${d}s`;return s.jsx(E.div,{ref:t,className:j,__css:{animation:C},...m})}return s.jsx(he,{ref:t,className:j,...m,__css:{width:h?"fit-content":void 0,...c,...k,_dark:{...c._dark,...k},animation:`${u}s linear infinite alternate ${xe}`}})});p.displayName="Skeleton";var N=({size:e="2rem",...t})=>s.jsx(p,{borderRadius:"full",boxSize:e,...t});N.displayName="SkeletonCircle";const _=()=>{const e=P(),[t,o]=l.useState(!1),c=R(),{user:n}=I(a=>a.user);return{postComment:async(a,i)=>{if(t)return;if(!n)throw new Error("Please login to comment");const d=$(z,"posts",a),u=(await U(d)).data(),x={comment:i,createdBy:n.id,createdAt:Date.now(),postId:a,id:Date.now()};try{await A(d,{comments:[...u.comments,x]}),e(J({id:a,comment:x})),c({title:"Success",message:"Comment added successfully",status:"success"})}catch(h){c({title:"Error",message:h.message,status:"error"})}finally{o(!1)}},isCommenting:t}},je=e=>{const[t,o]=l.useState(!0),[c,n]=l.useState(null),r=R();return l.useEffect(()=>{(async()=>{o(!0),n(null);try{const i=await U($(z,"users",e));n(i.data())}catch(i){r({title:"Error",message:i.message,status:"error"})}finally{o(!1)}})()},[]),{isLoading:t,userProfile:c,setUserProfile:n}};function W(e){const o=new Date().getTime()-e;if(o<1e3)return"just now";const c=Math.floor(o/1e3);if(c<60)return`${c} second${c===1?"":"s"} ago`;const n=Math.floor(o/(1e3*60));if(n<60)return`${n} minute${n===1?"":"s"} ago`;const r=Math.floor(o/(1e3*60*60));if(r<24)return`${r} hour${r===1?"":"s"} ago`;const a=Math.floor(o/(1e3*60*60*24));return`${a} day${a===1?"":"s"} ago`}const ke=({comment:e})=>{const{userProfile:t,isLoading:o}=je(e.createdBy);return o?s.jsx(Ce,{}):s.jsxs(f,{gap:4,children:[s.jsx(D,{to:`/Instagram-clone/${t==null?void 0:t.username}`,children:s.jsx(Y,{src:t==null?void 0:t.profilePictureUrl,size:"sm"})}),s.jsxs(f,{direction:"column",children:[s.jsxs(f,{gap:2,alignItems:"center",children:[s.jsx(D,{to:`/Instagram-clone/${t==null?void 0:t.username}`,children:s.jsx(g,{fontWeight:"bold",fontSize:12,children:t==null?void 0:t.username})}),s.jsx(g,{fontSize:14,children:e.comment})]}),s.jsx(g,{fontSize:12,color:"gray",children:W(e.createdAt)})]})]})},Ce=()=>s.jsxs(f,{gap:4,w:"full",alignItems:"center",children:[s.jsx(N,{h:10,w:"10"}),s.jsxs(f,{gap:1,flexDir:"column",children:[s.jsx(p,{height:2,width:100}),s.jsx(p,{height:2,width:50})]})]}),ye=({isOpen:e,onClose:t,post:o})=>{const{postComment:c,isCommenting:n}=_(),r=l.useRef(null),a=l.useRef(null),i=async d=>{d.preventDefault(),await c(o.id,r.current.value),r.current.value=""};return l.useEffect(()=>{const d=()=>{a.current.scrollTop=a.current.scrollHeight};e&&setTimeout(()=>{d()},100)},[e,o.comments.length]),s.jsxs(K,{isOpen:e,onClose:t,motionPreset:"slideInLeft",children:[s.jsx(Q,{}),s.jsxs(X,{bg:"black",border:"1px solid gray",maxW:"400px",children:[s.jsx(Z,{children:"Comments"}),s.jsx(ee,{}),s.jsxs(se,{pb:6,children:[s.jsx(f,{mb:4,gap:4,flexDir:"column",maxH:"250px",overflowY:"auto",ref:a,children:o.comments.map((d,u)=>s.jsx(ke,{comment:d},u))}),s.jsxs("form",{onSubmit:i,style:{marginTop:"2rem"},children:[s.jsx(B,{placeholder:"Comment",size:"sm",ref:r}),s.jsx(f,{w:"full",justifyContent:"flex-end",children:s.jsx(F,{type:"submit",ml:"auto",size:"sm",my:4,isLoading:n,children:"Post"})})]})]})]})]})},Se=e=>{var h;const t=P(),[o,c]=l.useState(!1),{user:n}=I(m=>m.user),[r,a]=l.useState((h=e==null?void 0:e.likes)==null?void 0:h.length),[i,d]=l.useState(e==null?void 0:e.likes.includes(n==null?void 0:n.id)),u=R();return{isLiked:i,likes:r,handleLikePost:async()=>{if(!o){if(!n)return u({title:"Error",message:"Please login to like post",status:"error"});c(!0);try{const m=$(z,"posts",e.id);await A(m,{likes:i?te(n.id):ne(n.id)}),d(!i),t(i?ae({postId:e.id,userId:n==null?void 0:n.id}):oe({postId:e.id,userId:n==null?void 0:n.id})),a(i?r-1:r+1),a(i?r-1:r+1)}catch(m){u({title:"Error",message:m.message,status:"error"})}finally{c(!1)}}},isUpdating:o}},we=({post:e,isProfilePage:t,creatorProfile:o})=>{var j,k;const{isCommenting:c,postComment:n}=_(),[r,a]=l.useState(""),{user:i}=I(C=>C.user),d=l.useRef(null),{handleLikePost:u,isLiked:x,likes:h}=Se(e),{isOpen:m,onOpen:y,onClose:S}=re(),w=async()=>{await n(e.id,r),a("")};return s.jsxs(b,{mb:10,marginTop:"auto",children:[s.jsxs(f,{alignItems:"center",gap:4,w:"full",pt:0,mb:2,mt:4,children:[s.jsx(b,{onClick:u,cursor:"pointer",fontSize:18,children:x?s.jsx(ce,{}):s.jsx(ie,{})}),s.jsx(b,{cursor:"pointer",fontSize:18,onClick:()=>d.current.focus(),children:s.jsx(le,{})})]}),s.jsxs(g,{fontWeight:600,fontSize:"sm",children:[h," likes"]}),t&&s.jsxs(g,{fontSize:"12",color:"gray",children:["Posted ",W(e.createdAt)]}),!t&&s.jsxs(s.Fragment,{children:[s.jsxs(g,{fontSize:"sm",fontWeight:700,children:[o==null?void 0:o.username," ",s.jsx(g,{as:"span",fontWeight:400,children:e==null?void 0:e.caption})]}),((j=e==null?void 0:e.comments)==null?void 0:j.length)>0&&s.jsxs(g,{fontSize:"sm",color:"gray",cursor:"pointer",onClick:y,children:["View all ",(k=e==null?void 0:e.comments)==null?void 0:k.length," comments"]}),m?s.jsx(ye,{isOpen:m,onClose:S,post:e}):null]}),i&&s.jsx(f,{alignItems:"center",gap:2,justifyContent:"space-between",w:"full",children:s.jsxs(de,{children:[s.jsx(B,{variant:"flushed",placeholder:"Add a comment...",fontSize:14,onChange:C=>a(C.target.value),value:r,ref:d}),s.jsx(me,{children:s.jsx(F,{fontSize:14,color:"blue.500",fontWeight:600,cursor:"pointer",_hover:{color:"white"},bg:"transparent",onClick:w,isLoading:c,children:"Post"})})]})})]})};export{ke as C,we as P,p as S,N as a,W as t,je as u};
